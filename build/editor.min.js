/*! editor 2014-12-05 */
!function(a,b,c,d){"use strict";function e(){this.init()}function f(a){this.id=D+=1,this.init(a)}function g(){var b;if(b=a("[data-editor]"),b.length>1)console.log("Multiple editors not supported. Picking up first."),b=b.first();else if(0===b.length)throw"Editor root element not found";F.root=b,b=F.root.find("[data-menu-container]"),0===b.length&&(b=a("<div>").attr("data-menu-container","").addClass("menu-container"),F.root.append(b)),F.menu=b,b=F.root.find("[data-edit]"),0===b.length&&(b=a("<article>").attr("data-edit","").append(a("<h2>").attr("data-placeholder","Title here").addClass("title")).append(a("<p>")),F.root.append(b)),F.editor=b,b=F.menu.find("[data-options]"),0===b.length&&(b=a("<div>").attr("data-options","").append(a("<div>").addClass("toggle").append(a("<a>").addClass("button icon").attr({href:"#","data-button-id":"toggle"}).html("&times;"))).append(a("<ul>").addClass("menu options-menu")),F.menu.append(b)),F.options=b,F.editor.attr({contenteditable:!0}),F.menu.find(".menu").hide(),F.lastFocused=d}function h(){G.localStorage=null!==b.localStorage}function i(b,c){var d,e;return-1===c&&(c=I.length,I.push(b)),F.menu.append(b.view),b.R={},b.view.find("[data-button-id]").each(function(){var d=a(this).attr("data-button-id").replace(/-([a-z0-9])/gi,function(a){return a[1].toUpperCase()});b.R[d]=E+=1,a(this).attr("data-extension-id",c),a(this).attr("data-id",E)}),e=[],b.subscribe.forEach(function(a){d=/^@.*$/gi,d.test(a)?(J[a]||(J[a]=[]),J[a].push(b.onEvent)):e.push(a)}),b.subscribe=e,c}function j(){var a;for(a=0;a<I.length;++a)i(I[a],a)}function k(){}function l(a){var b={};if(a)for(;a.parentNode&&(b[a.nodeName.toLowerCase()]=!0,a!==F.editor[0]);)a=a.parentNode;return b}function m(c){var e=a.extend({},H);if(H={time:new Date},H.selection=b.getSelection(),H.nodes=l(H.selection.focusNode),H.blur=H.selection.isCollapsed===!0&&e.isCollapsed!==d&&e.isCollapsed===!1,!1===H.selection.isCollapsed&&!1===M){if(a.contains(F.editor[0],H.selection.focusNode)){var f=H.selection.getRangeAt(0),g=f.getBoundingClientRect();H.position={top:b.pageYOffset+g.top,left:g.left,right:g.right,bottom:b.pageYOffset+g.bottom,width:g.width,height:g.height}}}else{var h=a(H.selection.focusNode?H.selection.focusNode:c.target);"#text"===h[0].nodeName&&(h=h.parent()),H.position={top:h.position().top,left:h.position().left,bottom:h.position().top+h.height(),right:h.position().left+h.width(),width:h.width(),height:h.height()}}return H.event=c,H.isCollapsed=H.selection.isCollapsed,e}function n(a,b,c){var d;b&&(d="keyup"===a?b.selection.focusNode:b.event.target,I.forEach(function(b){0!==b.id&&b.visible&&b.focusOut(a,d,H,c)}))}function o(a,b,c){var d;if(b){d="mouseup"===a?c.target:b.selection.focusNode;var e=d.nodeName.toLowerCase();I.forEach(function(b){-1!==b.subscribe.indexOf(e)&&b.focusIn(a,d,H,c)}),I.forEach(function(b){-1!==b.subscribe.indexOf("*")&&b.focusIn(a,e,H,c)})}}function p(a){var b=m(a);(H.blur||b.selection&&b.selection.focusNode!==H.selection.focusNode)&&n("keyup",b,a),H.selection.isCollapsed||o("keyup",H,a)}function q(a){var b=[],c=[];return a.which===d?"":(a.shiftKey&&b.push(N[16]),a.ctrlKey&&b.push(N[17]),a.altKey&&b.push(N[18]),a.metaKey&&b.push(N[91]),b.sort(),b.length&&c.push(b.join("+")),[16,17,18,91,93].indexOf(a.which)<0&&c.push(a.which),"@"+c.join("+"))}function r(a){var b=q(a);J.hasOwnProperty(b)&&J[b].some(function(a){return a(b,H)})}function s(b){a.contains(F.root,b.target)&&b.preventDefault()}function t(b){if(a.contains(F.root,b.target)&&b.preventDefault(),1===b.which){var c=m(b);(H.blur||c.event&&c.event.target!==H.event.target)&&n("mouseup",c,b),a.contains(F.editor[0],b.target)&&o("mouseup",H,b)}}function u(){M=!0}function v(){M=!1}function w(){}function x(){}function y(a){var b=a.is("[selected]");switch(a.attr("data-button-type")){case"select":return F.menu.find('[data-button-name="'+a.attr("data-button-name")+'"]').removeAttr("selected"),b?a.removeAttr("selected"):a.attr("selected",""),b?d:a.attr("data-button-id");case"radio":return F.menu.find('[data-button-name="'+a.attr("data-button-name")+'"]').removeAttr("selected"),b||a.attr("selected",""),a.attr("data-button-id");default:return b?a.removeAttr("selected"):a.attr("selected",""),!b}}function z(b){var c,d,e;d=a(b.currentTarget),console.log(d),c=parseInt(d.attr("data-extension-id"),10),e=y(d),I[c]&&(I[c].onClick(parseInt(d.attr("data-id"),10),e,H,d),b.preventDefault())}function A(){a(c).on({compositionend:v,compositionstart:u,keyup:p,keydown:r,mousedown:s,mouseup:t}),L={top:a(b).scrollTop(),left:a(b).scrollLeft(),timestamp:(new Date).getTime()},F.menu.on("click",'a[href="#"]',z),F.editor.on("mouseenter","> *",x),F.editor.on("click","*",function(a){a.preventDefault()}),a(b).on({resize:w})}function B(b,c){var d;c.view=b instanceof a?b:a(b),d=c.view.attr("data-subscribe"),c.subscribe=d?d.split(" ").filter(function(a){return!!a}):[]}function C(b,c){var d,e=function(b,c,d){var e=b.split(","),f=a("<a>").addClass("button").attr("href","#");e[0]&&f.attr("data-button-id",e[0]),e[1]&&f.html('<i class="fa fa-'+e[1]+'"></i>'),e[2]&&f.html(f.html()+e[2]),f.attr(c),d.append(a("<li>").append(f))};return!b||!b instanceof Array?(console.log("Failed to load extension `"+c.name+"`."),!1):(d=a("<ul>"),b.forEach(function(a){var b,c;if(a instanceof Object){switch(b=a.sep,c=a.name,a.type){case"select":a.buttons.forEach(function(a){e(a,{"data-button-type":"select","data-button-name":c},d)});break;case"radio":a.buttons.forEach(function(a){e(a,{"data-button-type":"radio","data-button-name":c},d)});break;default:a.buttons.forEach(function(a){e(a,{},d)})}b===!0&&d.find("li:last-child").addClass("sep-right")}}),void(c.view=a("<div>").append(d.addClass("menu").attr("data-extension-id",c.id))))}var D=-1,E=0,F={},G={},H={},I=[],J={},K=!1,L={},M=!1,N={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pgup",34:"pgdn",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",93:"cmd",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",186:";",187:"=",188:",",189:"-",191:"\\/",192:"`",219:"\\[",220:"\\\\",221:"\\]",222:"'"};e.prototype={init:function(){var a;g(),A(),h(),j(),a=c.createRange(),H=b.getSelection(),a.setStart(c.querySelector("[data-edit]"),1),H.removeAllRanges(),H.addRange(a),G.localStorage&&k(),K=!0,this.extend(new f({name:"options",loadFromSource:F.options,subscribe:["*"],bindings:{},onDraw:function(a){return a},onClick:function(a,b,c,d){a=d.attr("data-button-id"),I[0].bindings.hasOwnProperty(a)&&(I[0].bindings[a](c),I[0].close())},open:function(){},close:function(){},isOpen:function(){},bind:function(a,b){this.bindings[a]=b}}))},extend:function(a){return K?i(a,-1):(I.push(a),I.length-1)},selection:function(){return H},options:function(){return F.options},menu:function(){return F.menu},editor:function(){return F.editor},extensions:function(){return I},root:function(){return F.root},topNode:function(b){for(b instanceof a&&(b=b[0]);b&&b.parentNode!=F.editor[0];)b=b.parentNode;return a(b)},addOption:function(b,c){var d,e,f,g=function(b,c){var d=b.split(","),e=a("<li>").attr({"data-extension-id":0});return d[0]&&e.attr("data-button-id",d[0]),d[1]&&e.html('<i class="fa fa-'+d[1]+'"></i>'),d[2]&&e.html(e.html()+d[2]),c.append(e),d[0]};for(f in c)c.hasOwnProperty(f)&&(e=c[f],d=g(b.name+"."+f,I[0].view.find("ul")),I[0].bind(d,e))}},f.prototype={state:{},init:function(a){var b;if(this.name=a.name,a.loadFromSource){if(!1===B(a.loadFromSource,this))return}else{if(!1===C(a.structure,this))return;this.subscribe=[]}this.subscribe=this.subscribe.concat(a.subscribe),"options"===this.name?this.visible=!0:(this.view.css({position:"absolute",top:0,left:0}).hide(),this.visible=!1);for(b in a)-1===["show","hide","findViewById","init","focusIn","focusOut","state"].indexOf(b)&&(this[b]=a[b]);a.optionsMenu&&editor.addOption(this,a.optionsMenu),a.callback&&a.callback(this)},focusIn:function(b,c,d,e){var f=a(c);this.state={eventType:b,node:c,element:f,selection:d,event:e,position:{top:d.position.top,left:d.position.left}},this.onFocusIn(b,c,d,e)},focusOut:function(b,c,d,e){a.contains(this.view[0],e.target)||this.onFocusOut(b,c,d)},show:function(){var a=this.onDraw(this.state.position,this.state.node);this.view.css(a),this.view.find("[selected]").removeAttr("selected"),this.onLoad(this.state.node,this.state.selection.nodes),this.onShow(),this.view.is(":visible")||this.view.show(),this.visible=!0},hide:function(){this.onHide(),this.view.is(":visible")&&this.view.hide(),this.visible=!1},findViewById:function(a){return F.menu.find("[data-id="+a+"]")},onLoad:function(){},onHide:function(){},onShow:function(){},onEvent:function(){},onFocusIn:function(){this.show()},onFocusOut:function(){this.hide()},onClick:function(){},onDraw:function(a){return a}},b.Editor=e,b.Editor.Extension=f,b.editor=new e}(window.jQuery,window,window.document),function(a,b,c,d,e){a.extend(new b({name:"text",structure:[{name:"headings",type:"select",buttons:["h1,,H1","h2,,H2","h3,,H3"],sep:!0},{buttons:["bold,,<b>b</b>","italic,,<i>i</i>"],sep:!0}],optionsMenu:{"text,,TEXT":function(){d.alert("Viola adding new text")}},subscribe:["@cmd+b","@cmd+i","@enter","#text","a","code","p","b","i","strong","em","h1","h2","h3","h4","h5","h6"],onClick:function(a,b){switch(console.log(a+" "+b),a){case this.R.h1:e.execCommand("formatBlock",!1,b?"H1":"P");break;case this.R.h2:e.execCommand("formatBlock",!1,b?"H2":"P");break;case this.R.h3:e.execCommand("formatBlock",!1,b?"H3":"P");break;case this.R.bold:e.execCommand("bold",!1,null)||e.execCommand("formatBlock",!1,"B");break;case this.R.italic:e.execCommand("italic",!1,null)||e.execCommand("formatBlock",!1,"I")}},onFocusIn:function(){return this.state.element&&this.state.element.text().length>0&&this.show(),!0},onLoad:function(a,b){b.h1&&this.findViewById(this.R.h1).attr("selected",""),b.h2&&this.findViewById(this.R.h2).attr("selected",""),b.h3&&this.findViewById(this.R.h3).attr("selected",""),(b.b||b.strong)&&this.findViewById(this.R.bold).attr("selected",""),(b.i||b.em)&&this.findViewById(this.R.italic).attr("selected","")},onEvent:function(a,b,c){switch(a){case"@cmd+b":c.preventDefault(),e.execCommand("bold",!1,null);break;case"@cmd+i":c.preventDefault(),e.execCommand("italic",!1,null)}},onDraw:function(a){return{top:a.top-this.view.height(),left:a.left}},callback:function(a){a.view.find(".menu").addClass("default")}}))}(window.editor,window.Editor.Extension,window.jQuery,window,window.document);