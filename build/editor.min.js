/*! editor 2014-12-06 */
!function(a,b,c,d){"use strict";function e(){this.init()}function f(a){this.id=D+=1,this.init(a)}function g(){var b;if(b=a("[data-editor]"),b.length>1)console.log("Multiple editors not supported. Picking up first."),b=b.first();else if(0===b.length)throw"Editor root element not found";F.root=b,b=F.root.find("[data-menu-container]"),0===b.length&&(b=a("<div>").attr("data-menu-container","").addClass("menu-container"),F.root.append(b)),F.menu=b,b=F.root.find("[data-edit]"),0===b.length&&(b=a("<article>").attr("data-edit","").append(a("<h2>").attr("data-placeholder","Title here").addClass("title")).append(a("<p>")),F.root.append(b)),F.editor=b,b=F.menu.find("[data-options]"),0===b.length&&(b=a("<div>").css("position","absolute").attr("data-options","").append(a("<div>").addClass("toggle").append(a("<a>").addClass("button icon").attr({href:"#","data-button-id":"toggle"}).html("&times;"))).append(a("<ul>").addClass("menu options-menu")),F.menu.append(b)),F.options=b,F.editor.attr({contenteditable:!0}),F.menu.find(".menu").hide(),F.lastFocused=d}function h(){G.localStorage=null!==b.localStorage,c.execCommand("defaultParagraphSeparator",!1,"p"),c.execCommand("insertbronreturn",!1,!0)}function i(b,c){var d,e;return-1===c&&(c=I.length,I.push(b)),F.menu.append(b.view),b.R={},b.view.find("[data-button-id]").each(function(){var d=a(this).attr("data-button-id").replace(/-([a-z0-9])/gi,function(a){return a[1].toUpperCase()});b.R[d]=E+=1,a(this).attr("data-extension-id",c),a(this).attr("data-id",E)}),e=[],b.subscribe.forEach(function(a){d=/^@.*$/gi,d.test(a)?(J[a]||(J[a]=[]),J[a].push(b.onEvent)):e.push(a)}),b.subscribe=e,c}function j(){var a;for(a=0;a<I.length;++a)i(I[a],a)}function k(){}function l(a){var b={};if(a)for(;a.parentNode&&(b[a.nodeName.toLowerCase()]=!0,a!==F.editor[0]);)a=a.parentNode;return b}function m(c){var e=a.extend({},H);if(H={time:new Date},H.selection=b.getSelection(),H.nodes=l(H.selection.focusNode),H.blur=H.selection.isCollapsed===!0&&e.isCollapsed!==d&&e.isCollapsed===!1,!1===H.selection.isCollapsed&&!1===M){if(a.contains(F.editor[0],H.selection.focusNode)){var f=H.selection.getRangeAt(0),g=f.getBoundingClientRect();H.position={top:b.pageYOffset+g.top,left:g.left,right:g.right,bottom:b.pageYOffset+g.bottom,width:g.width,height:g.height}}}else{var h=a(H.selection.focusNode?H.selection.focusNode:c.target);"#text"===h[0].nodeName&&(h=h.parent()),H.position={top:h.position().top,left:h.position().left,bottom:h.position().top+h.height(),right:h.position().left+h.width(),width:h.width(),height:h.height()}}return H.event=c,H.isCollapsed=H.selection.isCollapsed,e}function n(a,b,c){var d;b&&(d="keyup"===a?b.selection.focusNode:b.event.target,I.forEach(function(b){0!==b.id&&b.visible&&b.focusOut(a,d,H,c)}))}function o(a,b,c){var d;if(b){d="mouseup"===a?c.target:b.selection.focusNode;var e=d.nodeName.toLowerCase();I.forEach(function(b){-1!==b.subscribe.indexOf("*")&&b.focusIn(a,d,H,c)}),I.forEach(function(b){-1!==b.subscribe.indexOf(e)&&b.focusIn(a,d,H,c)})}}function p(a){var b=r(a);J.hasOwnProperty(b)&&J[b].some(function(c){return console.log(b),c(b,a)})}function q(a){var b=m(a);(H.blur||b.selection&&b.selection.focusNode!==H.selection.focusNode)&&n("keyup",b,a),o("keyup",H,a)}function r(a){var b=[],c=[];return a.which===d?"":(a.shiftKey&&b.push(N[16]),a.ctrlKey&&b.push(N[17]),a.altKey&&b.push(N[18]),a.metaKey&&b.push(N[91]),b.sort(),b.length&&c.push(b.join("+")),[16,17,18,91,93].indexOf(a.which)<0&&N.hasOwnProperty(a.which)&&c.push(N[a.which]),"@"+c.join("+"))}function s(b){a.contains(F.root,b.target)&&b.preventDefault()}function t(b){if(a.contains(F.root,b.target)&&b.preventDefault(),1===b.which){var c=m(b);(H.blur||c.event&&c.event.target!==H.event.target)&&n("mouseup",c,b),a.contains(F.editor[0],b.target)&&o("mouseup",H,b)}}function u(){M=!0}function v(){M=!1}function w(){}function x(){}function y(a){var b=a.is("[selected]");switch(a.attr("data-button-type")){case"select":return F.menu.find('[data-button-name="'+a.attr("data-button-name")+'"]').removeAttr("selected"),b?a.removeAttr("selected"):a.attr("selected",""),b?d:a.attr("data-button-id");case"radio":return F.menu.find('[data-button-name="'+a.attr("data-button-name")+'"]').removeAttr("selected"),b||a.attr("selected",""),a.attr("data-button-id");default:return b?a.removeAttr("selected"):a.attr("selected",""),!b}}function z(b){var c,d,e;d=a(b.currentTarget),c=parseInt(d.attr("data-extension-id"),10),e=y(d),I[c]&&(I[c].onClick(parseInt(d.attr("data-id"),10),e,H,d),b.preventDefault())}function A(){a(c).on({compositionend:v,compositionstart:u,keyup:q,keydown:p,mousedown:s,mouseup:t}),L={top:a(b).scrollTop(),left:a(b).scrollLeft(),timestamp:(new Date).getTime()},F.menu.on("click",'a[href="#"]',z),F.editor.on("mouseenter","> *",x),F.editor.on("click","*",function(a){a.preventDefault()}),a(b).on({resize:w})}function B(b,c){var d;c.view=b instanceof a?b:a(b),d=c.view.attr("data-subscribe"),c.subscribe=d?d.split(" ").filter(function(a){return!!a}):[]}function C(b,c){var e,f=function(b,c,d){var e=b.split(","),f=a("<a>").addClass("button").attr("href","#");e[0]&&f.attr("data-button-id",e[0]),e[1]&&f.html('<i class="fa fa-'+e[1]+'"></i>'),e[2]&&f.html(f.html()+e[2]),f.attr(c),d.append(a("<li>").append(f))};return!b||!b instanceof Array?(console.log("Failed to load extension `"+c.name+"`."),!1):(c.view=a("<div>"),e=a("<ul>"),b.forEach(function(b){var g,h,i;if(b instanceof Object){switch(g=b.sep,h=b.name,i=b.break||!1,e===d&&(e=a("<ul>")),b.type){case"select":b.buttons.forEach(function(a){f(a,{"data-button-type":"select","data-button-name":h},e)});break;case"radio":b.buttons.forEach(function(a){f(a,{"data-button-type":"radio","data-button-name":h},e)});break;default:b.buttons.forEach(function(a){f(a,{},e)})}g===!0&&e.find("li:last-child").addClass("sep-right"),i===!0&&(c.view.append(e.addClass("menu").attr("data-extension-id",c.id)),e=d)}}),void(e&&c.view.append(e.addClass("menu").attr("data-extension-id",c.id))))}var D=-1,E=0,F={},G={},H={},I=[],J={},K=!1,L={},M=!1,N={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pgup",34:"pgdn",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",93:"cmd",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",186:";",187:"=",188:",",189:"-",191:"\\/",192:"`",219:"\\[",220:"\\\\",221:"\\]",222:"'"};e.prototype={init:function(){var d;g(),A(),h(),j(),d=c.createRange(),H=b.getSelection(),d.setStart(c.querySelector("[data-edit]"),1),H.removeAllRanges(),H.addRange(d),G.localStorage&&k(),K=!0,this.extend({name:"options",loadFromSource:F.options,subscribe:["*"],bindings:{},onDraw:function(b,c){for(;c&&c.parentNode!==this.editor.editor()[0];)c=c.parentNode;if(this.isOpen())return this.view.position();if(!c)return this.view.position();var d=this.editor.editor().position();return b=a(c).position(),{top:Math.max(d.top,b.top),left:Math.max(8-this.view.find(".toggle").outerWidth(),b.left-16-this.view.find(".toggle").outerWidth())}},onClick:function(a,b,c,d){switch(a){case this.R.toggle:this.isOpen()?this.close():this.open();break;default:a=d.attr("data-button-id"),I[0].bindings.hasOwnProperty(a)&&(I[0].bindings[a](c),I[0].close())}},open:function(){this.view.find(".menu").show(),this.view.find(".toggle a").addClass("open")},close:function(){this.view.find(".menu").hide(),this.view.find(".toggle a").removeClass("open")},isOpen:function(){return this.view.find(".menu").is(":visible")},bind:function(a,b){this.bindings[a]=b},callback:function(a){var b=a.editor.editor().position();a.view.css({top:b.top,left:Math.max(8-a.view.find(".toggle").outerWidth(),b.left-16-a.view.find(".toggle").outerWidth())})}})},extend:function(a){var b;return a.editor=this,b=new f(a),K?i(b,-1):(I.push(b),I.length-1)},selection:function(){return H},options:function(){return F.options},menu:function(){return F.menu},editor:function(){return F.editor},extensions:function(){return I},root:function(){return F.root},topNode:function(b){for(b instanceof a&&(b=b[0]);b&&b.parentNode!=F.editor[0];)b=b.parentNode;return a(b)},addOption:function(b,c){var d,e,f,g=function(b,c){var d=b.split(","),e=a("<li>").attr({"data-extension-id":0});return d[0]&&e.attr("data-button-id",d[0]),d[1]&&e.html('<i class="fa fa-'+d[1]+'"></i>'),d[2]&&e.html(e.html()+d[2]),c.append(e),d[0]};for(f in c)c.hasOwnProperty(f)&&(e=c[f],d=g(b.name+"."+f,I[0].view.find("ul")),I[0].bind(d,e))},saveSelection:function(){if(H.selection.getRangeAt&&H.selection.rangeCount){var a,b=[],c=H.selection.rangeCount;for(a=0;c>a;++a)b.push(H.selection.getRangeAt(a));return b}},restoreSelection:function(a){if(a){var b,c=a.length;for(H.selection.removeAllRanges(),b=0;c>b;++b)H.selection.addRange(a[b])}},surroundSelection:function(a){if(a&&H.selection.getRangeAt&&H.selection.rangeCount&&H.selection.rangeCount>0){var b=H.selection.getRangeAt(0);try{b.surroundContents(a)}catch(c){}}}},f.prototype={state:{},init:function(a){var b;if(this.name=a.name,this.editor=a.editor,a.loadFromSource){if(!1===B(a.loadFromSource,this))return}else{if(!1===C(a.structure,this))return;this.subscribe=[]}this.subscribe=this.subscribe.concat(a.subscribe),"options"===this.name?this.visible=!0:(this.view.css({position:"absolute",top:0,left:0}).hide(),this.visible=!1);for(b in a)-1===["editor","show","hide","findViewById","init","focusIn","focusOut","state"].indexOf(b)&&(this[b]=a[b]);a.optionsMenu&&this.editor.addOption(this,a.optionsMenu),a.callback&&a.callback(this)},focusIn:function(b,c,d,e){var f=a(c);this.state={eventType:b,node:c,element:f,selection:d,event:e,position:{top:d.position.top,left:d.position.left}},this.onFocusIn(b,c,d,e)},focusOut:function(b,c,d,e){a.contains(this.view[0],e.target)||this.onFocusOut(b,c,d)},show:function(){var a=this.onDraw(this.state.position,this.state.node);this.view.css(a),this.view.find("[selected]").removeAttr("selected"),this.onLoad(this.state.node,this.state.selection.nodes),this.onShow(),this.view.is(":visible")||this.view.show(),this.visible=!0},hide:function(){this.onHide(),this.view.is(":visible")&&this.view.hide(),this.visible=!1},findViewById:function(a){return F.menu.find("[data-id="+a+"]")},onLoad:function(){},onHide:function(){},onShow:function(){},onEvent:function(){},onFocusIn:function(){this.show()},onFocusOut:function(){this.hide()},onClick:function(){},onDraw:function(a){return a}},b.editor=new e}(window.jQuery,window,window.document),function(a,b,c,d){a.extend({name:"text",structure:[{name:"headings",type:"select",buttons:["h1,,H1","h2,,H2","h3,,H3"],sep:!0},{buttons:["bold,,<b>b</b>","italic,,<i>i</i>"],sep:!0},{buttons:["align-left,align-left","align-center,align-center"],sep:!0},{buttons:["link,link","code,code","quote,quote-right"],"break":!0},{buttons:["link-add,check","link-cancel,times"]}],optionsMenu:{"text,,TEXT":function(){c.alert("Viola adding new text")}},subscribe:["@cmd+b","@ctrl+b","@cmd+i","@ctrl+i","#text","div","a","span","code","p","blockquote","q","b","i","strong","em","h1","h2","h3","h4","h5","h6"],onClick:function(c,e){var f;switch(console.log(c+" "+e),c){case this.R.h1:d.execCommand("formatBlock",!1,e?"H1":"P");break;case this.R.h2:d.execCommand("formatBlock",!1,e?"H2":"P");break;case this.R.h3:d.execCommand("formatBlock",!1,e?"H3":"P");break;case this.R.bold:d.execCommand("bold",!1,null);break;case this.R.italic:d.execCommand("italic",!1,null);break;case this.R.alignLeft:d.execCommand("justifyleft",!1,null);break;case this.R.alignCenter:d.execCommand("justifycenter",!1,null);break;case this.R.link:if(e)this._temp=a.saveSelection();else{for(f=this.state.node;f&&"a"!=f.nodeName.toLowerCase();)f=f.parentNode;this.view.find("input").first().val(f?b(f).attr("href"):"")}this.view.find(".menu").hide().last().show();break;case this.R.linkAdd:for(f=this.state.node,a.restoreSelection(this._temp);f&&"a"!=f.nodeName.toLowerCase();)f=f.parent;f?b(f).attr("href",this.view.find("input").first().val()):d.execCommand("createLink",!1,this.view.find("input").first().val()),this.hide();break;case this.R.linkCancel:for(f=this.state.node;f&&"a"!=f.nodeName.toLowerCase();)f=f.parent;f&&(f=b(f),f.before(f.html()),f.remove()),this.hide();break;case this.R.quote:d.execCommand("formatBlock",!1,e?"BLOCKQUOTE":"P");break;case this.R.code:if(e)a.surroundSelection(d.createElement("code"));else{for(f=this.state.node;f&&"code"!=f.nodeName.toLowerCase();)f=f.parent;f&&(f=b(f),f.before(f.html()),f.remove())}}},onFocusIn:function(a,b){return this.view.find(".menu").hide().first().show(),b&&"#text"===b.nodeName&&this.state.selection.isCollapsed?!0:(this.state.element&&this.state.element.text().length>0&&this.show(),!0)},onLoad:function(a,b){var c;b.h1&&this.findViewById(this.R.h1).attr("selected",""),b.h2&&this.findViewById(this.R.h2).attr("selected",""),b.h3&&this.findViewById(this.R.h3).attr("selected",""),(b.b||b.strong)&&this.findViewById(this.R.bold).attr("selected",""),(b.i||b.em)&&this.findViewById(this.R.italic).attr("selected",""),"center"===c?this.findViewById(this.R.alignCenter).attr("selected",""):"left"===c&&this.findViewById(this.R.alignLeft).attr("selected",""),(b.blockquote||b.q)&&this.findViewById(this.R.quote).attr("selected",""),b.a&&this.findViewById(this.R.link).attr("selected",""),b.code&&this.findViewById(this.R.code).attr("selected","")},onEvent:function(a,b){switch(a){case"@cmd+b":case"@ctrl+b":return b.preventDefault(),d.execCommand("bold",!1,null),!0;case"@cmd+i":case"@ctrl+i":return b.preventDefault(),d.execCommand("italic",!1,null),!0;case"@shift+enter":return b.preventDefault(),d.execCommand("insertHTML",!1,"<br>"),!0}return!1},onDraw:function(a,c){var d=this.editor.editor().position();if(!this.state.selection.isCollapsed)return{top:Math.max(0,a.top-this.view.outerHeight()-2),left:Math.max(d.left,a.left+(this.state.selection.position.width-this.view.outerWidth())/2)};c=c instanceof b?c:b(c);var e={top:parseInt(c.css("marginTop"),10),left:parseInt(c.css("marginLeft"),10)};return{top:Math.max(0,a.top+e.top-this.view.outerHeight()-2),left:Math.max(d.left,a.left+e.left+(c.outerWidth()-this.view.outerWidth())/2)}},callback:function(a){var c=a.view.find(".menu");c.addClass("default"),c.last().prepend(b("<li>").append(b("<input>").attr({type:"text",placeholder:"Paste or type a link"}))).hide()}})}(window.editor,window.jQuery,window,window.document);